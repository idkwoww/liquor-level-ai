// Store last N predictions to smooth results
let predictionHistory = [];
const historyLength = 10; // adjust: bigger = smoother but slower to react

async function predict() {
  const prediction = await model.predict(webcam.canvas);

  // Find highest confidence class
  let highest = prediction[0];
  for (let i = 1; i < prediction.length; i++) {
    if (prediction[i].probability > highest.probability) {
      highest = prediction[i];
    }
  }

  // Add to history
  predictionHistory.push(highest.className);
  if (predictionHistory.length > historyLength) {
    predictionHistory.shift();
  }

  // Find most common class in history
  let counts = {};
  for (let c of predictionHistory) {
    counts[c] = (counts[c] || 0) + 1;
  }
  let stableClass = Object.keys(counts).reduce((a, b) =>
    counts[a] > counts[b] ? a : b
  );

  // Show stable class instead of bouncing %s
  document.getElementById("label-container").innerText = stableClass;
  
  window.requestAnimationFrame(predict);
}
